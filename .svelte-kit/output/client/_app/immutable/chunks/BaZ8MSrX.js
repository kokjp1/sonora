const i="dbb3ee14d83a436f937f959219c52980",l="http://127.0.0.1:5173/callback",d=["user-read-email","user-read-private","user-read-currently-playing","user-read-playback-state"].join(" "),o={ACCESS:"spotify_access_token",VERIFIER:"spotify_code_verifier"};async function g(){const t=u(128),a=await h(t);localStorage.setItem(o.VERIFIER,t);try{localStorage.setItem("spotify_post_login_redirect",location.pathname+location.search+location.hash)}catch{}const e=new URLSearchParams({response_type:"code",client_id:i,redirect_uri:l,scope:d,code_challenge_method:"S256",code_challenge:a});window.location.assign(`https://accounts.spotify.com/authorize?${e.toString()}`)}function u(t=128){let a="";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<t;n++)a+=e.charAt(Math.floor(Math.random()*e.length));return a}async function h(t){const a=new TextEncoder().encode(t),e=await crypto.subtle.digest("SHA-256",a);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(e)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function f(){const t=new URL(window.location.href),a=t.searchParams.get("code"),e=t.searchParams.get("error");if(!a&&!e)return!1;if(e)return history.replaceState({},document.title,location.pathname),!0;const n=localStorage.getItem(o.VERIFIER)||"",r=new URLSearchParams;r.append("client_id",i),r.append("grant_type","authorization_code"),r.append("code",a),r.append("redirect_uri",l),r.append("code_verifier",n);const c=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r}),s=await c.json();return c.ok&&s.access_token&&localStorage.setItem(o.ACCESS,s.access_token),history.replaceState({},document.title,location.pathname),!0}function S(){return!!localStorage.getItem(o.ACCESS)}function m(){localStorage.removeItem(o.ACCESS),localStorage.removeItem(o.VERIFIER)}async function p(t){const a=localStorage.getItem(o.ACCESS);if(!a)throw new Error("Not authenticated");const e=await fetch(`https://api.spotify.com/v1${t}`,{headers:{Authorization:`Bearer ${a}`}});if(e.status===204)return null;if(!e.ok)throw e.status===401&&localStorage.removeItem(o.ACCESS),new Error(`${e.status} ${e.statusText}`);return e.json()}const y=()=>p("/me/player/currently-playing"),C=t=>p(`/tracks/${t}`);export{S as a,C as b,y as g,f as h,m as l,g as r};
