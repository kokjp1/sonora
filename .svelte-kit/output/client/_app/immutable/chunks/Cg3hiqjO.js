const d="dbb3ee14d83a436f937f959219c52980",u="http://127.0.0.1:5173/callback",g=["user-read-email","user-read-private","user-read-currently-playing","user-read-playback-state","user-modify-playback-state"].join(" "),r={ACCESS:"spotify_access_token",VERIFIER:"spotify_code_verifier"};async function C(){const e=y(128),o=await S(e);localStorage.setItem(r.VERIFIER,e);try{localStorage.setItem("spotify_post_login_redirect",location.pathname+location.search+location.hash)}catch{}const t=new URLSearchParams({response_type:"code",client_id:d,redirect_uri:u,scope:g,code_challenge_method:"S256",code_challenge:o});window.location.assign(`https://accounts.spotify.com/authorize?${t.toString()}`)}function y(e=128){let o="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let c=0;c<e;c++)o+=t.charAt(Math.floor(Math.random()*t.length));return o}async function S(e){const o=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",o);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(t)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function w(){const e=new URL(window.location.href),o=e.searchParams.get("code"),t=e.searchParams.get("error");if(!o&&!t)return!1;if(t)return history.replaceState({},document.title,location.pathname),!0;const c=localStorage.getItem(r.VERIFIER)||"",a=new URLSearchParams;a.append("client_id",d),a.append("grant_type","authorization_code"),a.append("code",o),a.append("redirect_uri",u),a.append("code_verifier",c);const s=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}),i=await s.json();return s.ok&&i.access_token&&localStorage.setItem(r.ACCESS,i.access_token),history.replaceState({},document.title,location.pathname),!0}function E(){return!!localStorage.getItem(r.ACCESS)}function _(){localStorage.removeItem(r.ACCESS),localStorage.removeItem(r.VERIFIER)}async function h(e,o={}){const t=localStorage.getItem(r.ACCESS);if(!t)throw new Error("Not authenticated");const{method:c="GET",headers:a={},body:s=null,json:i=!1}=o,f={Authorization:`Bearer ${t}`,...a},l={method:c,headers:f};s!=null&&(l.body=i?JSON.stringify(s):s,i&&(l.headers={"Content-Type":"application/json",...l.headers}));const n=await fetch(`https://api.spotify.com/v1${e}`,l);if(n.status===204)return null;if(!n.ok)throw n.status===401&&localStorage.removeItem(r.ACCESS),new Error(`${n.status} ${n.statusText}`);if((n.headers.get("content-type")||"").toLowerCase().includes("application/json"))return n.json();const p=await n.text();if(!p)return null;try{return JSON.parse(p)}catch{return p}}const I=()=>h("/me/player/currently-playing"),R=e=>h(`/tracks/${e}`);export{E as a,R as b,h as c,I as g,w as h,_ as l,C as r};
